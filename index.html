<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Be My Valentine?</title>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        :root { --primary: #ff4d6d; --bg: #fff0f3; }
        body { background-color: var(--bg); margin: 0; height: 100vh; display: flex; justify-content: center; align-items: center; font-family: 'Poppins', sans-serif; overflow: hidden; touch-action: manipulation; }

        .card {
            background: white; padding: 30px; border-radius: 30px;
            box-shadow: 0 20px 50px rgba(255, 77, 109, 0.3);
            text-align: center; border: 4px solid var(--primary);
            width: 85%; max-width: 380px; z-index: 10; position: relative;
        }

        h1 { font-family: 'Pacifico', cursive; color: var(--primary); font-size: 1.8rem; margin-top: 10px; }
        .heart-icon { font-size: 50px; color: var(--primary); animation: beat 0.8s infinite alternate; }
        @keyframes beat { to { transform: scale(1.2); } }

        #choose-wisely { color: #000000; font-size: 1.1rem; margin-top: -10px; margin-bottom: 10px; font-weight: 600; min-height: 24px; }

        .btn-container { display: flex; justify-content: center; gap: 15px; margin-top: 30px; min-height: 60px; }
        
        button { 
            width: 100px; height: 50px; font-size: 1rem; font-weight: 600; 
            border: none; border-radius: 50px; cursor: pointer; 
            display: flex; justify-content: center; align-items: center;
        }

        #startBtn { width: auto; padding: 0 25px; background: var(--primary); color: white; margin: 0 auto; transition: 0.3s; }
        #yesBtn { background: var(--primary); color: white; transition: 0.3s; z-index: 101; }

        #noBtn { 
            background: #8d99ae; color: white; 
            transition: all 0.4s ease-out; 
            position: fixed; z-index: 100;
            pointer-events: auto;
        }

        #no-wrapper { width: 100px; height: 50px; display: flex; justify-content: center; align-items: center; }

        .hidden { display: none !important; }
        #timer-text { font-size: 0.8rem; color: #ff758f; margin-top: 15px; font-weight: bold; }

        .floating-heart { position: absolute; color: var(--primary); pointer-events: none; animation: float 4s linear forwards; z-index: 1; }
        @keyframes float { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; } }
    </style>
</head>
<body>

    <div class="card">
        <div class="heart-icon">‚ù§Ô∏è</div>
        <div id="step1">
            <h1>You have a message!</h1>
            <p>From someone special...</p>
            <button id="startBtn" onclick="initGame()">Open Letter ‚úâÔ∏è</button>
        </div>
        <div id="step2" class="hidden">
            <h1 id="mainTitle">Will you be my Valentine?</h1>
            <p id="choose-wisely">Choose wisely...</p>
            <div class="btn-container">
                <button id="yesBtn" onclick="showSuccess()">Yes!</button>
                <div id="no-wrapper">
                    <button id="noBtn" onmouseover="moveNo()" ontouchstart="moveNo()">No</button>
                </div>
            </div>
            <p id="timer-text">Wait 3s...</p>
        </div>
        <div id="step3" class="hidden">
            <h1 id="successTitle">Yay!</h1>
            <p id="finalMsg" style="font-weight: bold; color: var(--primary);"></p>
            <img src="https://media.giphy.com/media/KztT2c4u8mYYUiMKdJ/giphy.gif" width="150" style="border-radius:15px; margin-top:15px;">
        </div>
    </div>

    <audio id="trollSound" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>

    <script>
        const audio = document.getElementById('trollSound');
        const noBtn = document.getElementById('noBtn');
        const noWrapper = document.getElementById('no-wrapper');
        const trollText = document.getElementById('choose-wisely');
        let trollActive = false;

        const trollMessages = ["Too slow! üòÇ", "Nice try! üòâ", "Not today!", "Keep trying!", "Over here! üèÉ‚Äç‚ôÇÔ∏è", "Missed me!", "Wrong button! üòú", "Are you even trying?", "So close! No.", "Oops! ü§≠"];
        const successMessages = ["I Knew It! ‚ù§Ô∏è", "Best decision ever!", "You've made me the happiest person!", "Prepare for the best date ever!", "I'm yours now! No refunds! üòú", "You just won my heart! üèÜ", "My heart just did a flip! üíñ", "Yay! Let's celebrate! ‚ú®", "You're stuck with me now! üòç", "I'm the luckiest person alive!", "Everything is better with you!", "Can't wait for our special day!", "You + Me = Forever ‚ù§Ô∏è", "I was sweating for a second! üòÇ", "My Valentine! üåπ", "You're officially my favorite person!", "Let the romance begin! ü•Ç", "A million times YES! ü•∞", "You have excellent taste!", "I'm over the moon! üåô"];

        setInterval(() => {
            const heart = document.createElement('div');
            heart.innerHTML = '‚ù§Ô∏è';
            heart.className = 'floating-heart';
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.top = '100vh';
            heart.style.animationDuration = (Math.random() * 2 + 3) + 's';
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), 4000);
        }, 400);

        function setInitialNoPosition() {
            const rect = noWrapper.getBoundingClientRect();
            noBtn.style.left = rect.left + 'px';
            noBtn.style.top = rect.top + 'px';
        }

        function initGame() {
            audio.play().then(() => { audio.pause(); audio.currentTime = 0; });
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.remove('hidden');
            setInitialNoPosition();
            let timeLeft = 3;
            const timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timer-text').innerText = `Wait ${timeLeft}s...`;
                if(timeLeft <= 0) {
                    clearInterval(timer);
                    trollActive = true;
                    document.getElementById('timer-text').innerText = "Try to click No! üòâ";
                    noBtn.style.backgroundColor = "#ff4d6d";
                }
            }, 1000);
        }

        function moveNo(e) {
            if(trollActive) {
                if(e) e.preventDefault(); // Prevents clicking the button on mobile
                audio.currentTime = 0;
                audio.play();
                // Screen boundaries for mobile
                const x = Math.random() * (window.innerWidth - 110);
                const y = Math.random() * (window.innerHeight - 60);
                noBtn.style.left = x + 'px';
                noBtn.style.top = y + 'px';
                trollText.innerText = trollMessages[Math.floor(Math.random() * trollMessages.length)];
            }
        }

        function showSuccess() {
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.remove('hidden');
            noBtn.style.display = 'none';
            document.getElementById('finalMsg').innerText = successMessages[Math.floor(Math.random() * successMessages.length)];
            var end = Date.now() + (5 * 1000);
            (function frame() {
                confetti({ particleCount: 4, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#ff4d6d', '#ffffff'] });
                confetti({ particleCount: 4, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#ff4d6d', '#ffffff'] });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
        }
    </script>
</body>
</html>